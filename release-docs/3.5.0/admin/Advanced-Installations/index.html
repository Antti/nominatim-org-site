<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Advanced Installations - Nominatim 3.5.0</title>
  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../extra.css" rel="stylesheet">
  <link href="../../styles.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Advanced Installations";
    var mkdocs_page_input_path = "admin/Advanced-Installations.md";
    var mkdocs_page_url = "/admin/Advanced-Installations/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Nominatim 3.5.0</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">API Reference</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../api/Overview/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/Search/">Search</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/Reverse/">Reverse</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/Lookup/">Address Lookup</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/Details/">Details</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/Status/">Status</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/Output/">Place Output Formats</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/Faq/">FAQ</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Administration Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../Installation/">Basic Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../Import-and-Update/">Importing and Updating</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Advanced Installations</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#advanced-installations">Advanced installations</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#importing-multiple-regions">Importing multiple regions</a></li>
        
            <li><a class="toctree-l4" href="#updating-multiple-regions">Updating multiple regions</a></li>
        
            <li><a class="toctree-l4" href="#verification-and-further-setup">Verification and further setup</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../Migration/">Migration from older Versions</a>
                </li>
                <li class="">
                    
    <a class="" href="../Faq/">Troubleshooting</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developers Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../develop/overview/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../develop/Import/">OSM Data Import</a>
                </li>
                <li class="">
                    
    <a class="" href="../../develop/Ranking/">Place Ranking</a>
                </li>
                <li class="">
                    
    <a class="" href="../../develop/Postcodes/">Postcodes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../develop/Documentation/">Documentation</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">External Data Sources</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../data-sources/overview/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../data-sources/US-Tiger/">US Census (Tiger)</a>
                </li>
                <li class="">
                    
    <a class="" href="../../data-sources/GB-Postcodes/">GB Postcodes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../data-sources/Country-Grid/">Country Grid</a>
                </li>
                <li class="">
                    
    <a class="" href="../../data-sources/Wikipedia-Wikidata/">Wikipedia & Wikidata</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Appendix</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../appendix/Install-on-Centos-7/">Installation on CentOS 7</a>
                </li>
                <li class="">
                    
    <a class="" href="../../appendix/Install-on-Centos-8/">Installation on CentOS 8</a>
                </li>
                <li class="">
                    
    <a class="" href="../../appendix/Install-on-Ubuntu-18/">Installation on Ubuntu 18</a>
                </li>
                <li class="">
                    
    <a class="" href="../../appendix/Install-on-Ubuntu-20/">Installation on Ubuntu 20</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Nominatim 3.5.0</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Administration Guide &raquo;</li>
        
      
    
    <li>Advanced Installations</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/openstreetmap/Nominatim/edit/master/docs/admin/Advanced-Installations.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="advanced-installations">Advanced installations<a class="headerlink" href="#advanced-installations" title="Permanent link"></a></h1>
<p>This page contains instructions for setting up multiple countries in 
your Nominatim database. It is assumed that you have already successfully
installed the Nominatim software itself, if not return to the 
<a href="../Installation/">installation page</a>.</p>
<h2 id="importing-multiple-regions">Importing multiple regions<a class="headerlink" href="#importing-multiple-regions" title="Permanent link"></a></h2>
<p>To import multiple regions in your database, you need to configure and run <code>utils/import_multiple_regions.sh</code> file. This script will set up the update directory which has the following structure:</p>
<div class="codehilite"><pre><span></span>update
    ├── europe
    │   ├── andorra
    │   │   └── sequence.state
    │   └── monaco
    │       └── sequence.state
    └── tmp
        ├── combined.osm.pbf
        └── europe
                ├── andorra-latest.osm.pbf
                └── monaco-latest.osm.pbf
</pre></div>


<p>The <code>sequence.state</code> files will contain the sequence ID, which will be used by pyosmium to get updates. The tmp folder is used for import dump.</p>
<h3 id="configuring-multiple-regions">Configuring multiple regions<a class="headerlink" href="#configuring-multiple-regions" title="Permanent link"></a></h3>
<p>The file <code>import_multiple_regions.sh</code> needs to be edited as per your requirement:</p>
<ol>
<li>
<p>List of countries. eg:</p>
<div class="codehilite"><pre><span></span>COUNTRIES=&quot;europe/monaco europe/andorra&quot;
</pre></div>


</li>
<li>
<p>Path to Build directory. eg:</p>
<div class="codehilite"><pre><span></span>NOMINATIMBUILD=&quot;/srv/nominatim/build&quot;
</pre></div>


</li>
<li>
<p>Path to Update directory. eg:</p>
<div class="codehilite"><pre><span></span>UPDATEDIR=&quot;/srv/nominatim/update&quot;
</pre></div>


</li>
<li>
<p>Replication URL. eg:</p>
<div class="codehilite"><pre><span></span>BASEURL=&quot;https://download.geofabrik.de&quot;
DOWNCOUNTRYPOSTFIX=&quot;-latest.osm.pbf&quot;
</pre></div>


</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If your database already exists and you want to add more countries, replace the setting up part
<code>${SETUPFILE} --osm-file ${UPDATEDIR}/tmp/combined.osm.pbf --all 2&gt;&amp;1</code>
with <code>${UPDATEFILE} --import-file ${UPDATEDIR}/tmp/combined.osm.pbf 2&gt;&amp;1</code>.</p>
</div>
<h3 id="setting-up-multiple-regions">Setting up multiple regions<a class="headerlink" href="#setting-up-multiple-regions" title="Permanent link"></a></h3>
<p>Run the following command from your Nominatim directory after configuring the file.</p>
<div class="codehilite"><pre><span></span>bash ./utils/import_multiple_regions.sh
</pre></div>


<div class="admonition danger">
<p class="admonition-title">Important<p>This file uses osmium-tool. It must be installed before executing the import script.
Installation instructions can be found <a href="https://osmcode.org/osmium-tool/manual.html#installation">here</a>.</p>
</p>
</div>
<h2 id="updating-multiple-regions">Updating multiple regions<a class="headerlink" href="#updating-multiple-regions" title="Permanent link"></a></h2>
<p>To import multiple regions in your database, you need to configure and run <code>utils/update_database.sh</code>.
This uses the update directory set up while setting up the DB.   </p>
<h3 id="configuring-multiple-regions_1">Configuring multiple regions<a class="headerlink" href="#configuring-multiple-regions_1" title="Permanent link"></a></h3>
<p>The file <code>update_database.sh</code> needs to be edited as per your requirement:</p>
<ol>
<li>
<p>List of countries. eg:</p>
<div class="codehilite"><pre><span></span>COUNTRIES=&quot;europe/monaco europe/andorra&quot;
</pre></div>


</li>
<li>
<p>Path to Build directory. eg:</p>
<div class="codehilite"><pre><span></span>NOMINATIMBUILD=&quot;/srv/nominatim/build&quot;
</pre></div>


</li>
<li>
<p>Path to Update directory. eg:</p>
<div class="codehilite"><pre><span></span>UPDATEDIR=&quot;/srv/nominatim/update&quot;
</pre></div>


</li>
<li>
<p>Replication URL. eg:</p>
<div class="codehilite"><pre><span></span>BASEURL=&quot;https://download.geofabrik.de&quot;
DOWNCOUNTRYPOSTFIX=&quot;-updates&quot;
</pre></div>


</li>
<li>
<p>Followup can be set according to your installation. eg: For Photon,</p>
<div class="codehilite"><pre><span></span>FOLLOWUP=&quot;curl http://localhost:2322/nominatim-update&quot;
</pre></div>


<p>will handle the indexing.</p>
</li>
</ol>
<h3 id="updating-the-database">Updating the database<a class="headerlink" href="#updating-the-database" title="Permanent link"></a></h3>
<p>Run the following command from your Nominatim directory after configuring the file.</p>
<div class="codehilite"><pre><span></span>bash ./utils/update_database.sh
</pre></div>


<p>This will get diffs from the replication server, import diffs and index the database. The default replication server in the script(<a href="https://download.geofabrik.de">Geofabrik</a>) provides daily updates.</p>
<h2 id="verification-and-further-setup">Verification and further setup<a class="headerlink" href="#verification-and-further-setup" title="Permanent link"></a></h2>
<p>Instructions for import verification and other details like importing Wikidata can be found in <a href="../Import-and-Update/">import and update page</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Migration/" class="btn btn-neutral float-right" title="Migration from older Versions">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Import-and-Update/" class="btn btn-neutral" title="Importing and Updating"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/openstreetmap/Nominatim/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../Import-and-Update/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Migration/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
